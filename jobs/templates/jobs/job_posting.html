{% load static %}
{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <title>Job Posting Details</title>
    {% tailwind_css %}
    {% if messages %}
        {% include 'includes/message_box.html' %}
    {% endif %}
    <link rel="stylesheet" href="{% static 'css/dist/custom.css' %}">

    <script>
      const blurPage = ()=>{
          // Disable scroll
          $('body').addClass("overflow-hidden");
          // Blur
          // Make semi transparent for black background to be semi visible           
          $("nav").addClass("opacity-50 pointer-events-none");
          $(".search_job_bar").addClass("opacity-50 pointer-events-none");
          $(".main_page").addClass("opacity-50 pointer-events-none");
      }
      const unblurPage = ()=>{
          $('body').removeClass("overflow-hidden");

          $("nav").removeClass("opacity-50 pointer-events-none");
          $(".search_job_bar").removeClass("opacity-50 pointer-events-none");
          $(".main_page").removeClass("opacity-50 pointer-events-none");

      }

      $(document).ready(function(){
        $("#job_application_btn").click(()=>{
          blurPage();
          $("#job_application_modal").show();
        });
        $("#job_application_exit, #job_application_cancel").click(()=>{
          unblurPage();
          $("#job_application_modal").hide();
        })
        $("input[type='file']").change(function() { this.form.submit() })
      });
    </script>
</head>
<body class="w-screen h-screen bg-black">
    <!-- Navbar -->
    {% include 'includes/headings.html' %}
    <!-- Search Job Bar -->
    {% include 'includes/search_job_bar.html' %}
    <div class="main_page min-h-[calc(100vh-150px)] flex flex-col items-center bg-gray-200">
      <div class="p-10 flex flex-col rounded-xl bg-white">
        
        <div class="flex">
          <img src="{{ job_posting.company_logo.url }}" class="w-20 h-20 rounded-lg">

          <div class="flex flex-col flex-1">
            <h1 class="text-xl font-bold ml-3">{{ job_posting.job_title }}</h1>

            <div class="flex flex-wrap">
              {% for tag in job_posting.tags %}
              <div class="min-w-10 h-6 mx-3 mt-2 px-3 flex justify-center items-center text-xs bg-cyan-200 box-border rounded-2xl border-2 border-solid border-black">
                <p>{{ tag }}</p>
              </div>
              {% endfor %}
            </div>
          </div>

          <div class="ml-auto mr-5 my-auto flex flex-col items-center">
            <button id="job_application_btn" class="px-4 py-2 bg-purple-700 text-white text-sm font-bold rounded-lg">
              {% if edit_application_fields.already_applied %}
              Edit Entry
              {% else %}
              Apply Now
              {% endif %}
            </button>
            {% if edit_application_fields.already_applied %}
              <p class="text-xs">Last Updated: {{ edit_application_fields.form.date_updated }}</p>
            {% endif %}
          </div>

        </div>
        
        <hr class="border-top-2px my-6  ">

        <div class="flex flex-col gap-4">
          <h1 class="font-bold text-2xl">Job Description</h1>
          <p class="text-sm">{{ job_posting.job_description }}</p>
        </div>

        <hr class="border-top-2px my-6">
        
        <div class="flex">

          <div class="w-1/2 flex flex-col gap-2">

            <div class="flex items-center">
                <img src="{% static 'jobs/images/location.png' %}" class="profile_detail_icon">
                <p id="job" class="text-sm font-medium">{{ job_posting.address }}</p>
            </div>

            <div class="flex items-center">
                <img src="{% static 'jobs/images/field.png' %}" class="profile_detail_icon">
                <p id="job" class="text-sm font-medium">{{ job_posting.job_field }}</p>
            </div>

            <div class="flex items-center">
                <img src="{% static 'jobs/images/calendar.png' %}" class="profile_detail_icon">
                <p id="job" class="text-sm font-medium">Deadline: {{ job_posting.hiring_deadline }}</p>
            </div>

            <div class="flex items-center">
                <img src="{% static 'jobs/images/salary.png' %}" class="profile_detail_icon">
                <p id="job" class="text-sm font-medium">{{ job_posting.min_salary }} - {{ job_posting.max_salary }} Pesos/year</p>
            </div>
            
          </div>

          <div class="flex flex-col">
            <h1 class="font-bold text-2xl">Core Competencies</h1>
            <p>{{ job_posting.core_competencies }}</p>
          </div>

        </div>

      </div>

      <!-- Other Jobs Scrollable -->
      <div class="flex max-w-[800px] mt-6 gap-4 overflow-x-scroll flex-nowrap">
        {% for job_posting in other_job_postings %}
          <!-- Job-Posting Div -->
          <div class="p-2 pb-5 my-1 min-w-[350px] rounded-xl bg-white shadow-xl box-border">
            <!-- Colored Section -->
            <div class="relative p-5 pb-2 h-60 mb-5 bg-orange-300 rounded-xl">
              <h1 class="text-xl font-bold">{{ job_posting.job_title }}</h1>
              <img src="{{ job_posting.company_logo.url }}" class="w-10 h-10 my-2">
              <!-- Tags Section -->
              <div class="flex flex-wrap">
                {% for tag in job_posting.tags %}
                <div class="min-w-10 h-6 m-2 mb-1 px-3 flex justify-center items-center text-xs bg-orange-300 box-border rounded-2xl border-2 border-solid border-black">
                  <p>{{ tag }}</p>
                </div>
                {% endfor %}
              </div>
              <p class="text-xs absolute bottom-2">Open until:</p>
              <p class="text-xs absolute bottom-2 right-5">{{ job_posting.hiring_deadline }}</p>
            </div>
            <div class="flex justify-between">
              <p class="font-bold ml-3">₱{{ job_posting.min_salary }} - ₱{{ job_posting.max_salary }}</p>
              <a href="{% url 'job_posting' id=job_posting.id %}"><button class="w-20 h-8 mr-3 bg-black text-white rounded-2xl">Details</button></a>
            </div>
          </div>
        {% endfor %}
      </div>

    </div>  

  

    <!-- Apply Job -->
    <div id="job_application_modal" class="fixed w-3/5 max-h-[90vh] p-16 py-7 top-[2rem] left-1/2 translate-x-[-50%] rounded-2xl bg-white z-10 overflow-y-auto" style="display: none;">
      <form method="POST" class="flex flex-col items-center">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="job_application_form">
          <input type="hidden" name="already_applied" value="{{ edit_application_fields.already_applied }}">

          <h1 class="text-2xl text-black text-center">Job Application Form</h1>
          <img id="job_application_exit" src="{% static 'jobs/images/cross_mark_icon.png' %}" class="w-8 h-8 hover:cursor-pointer absolute top-6 right-6" alt="Exit Button">
   
          <hr class="w-[96%] mt-2 border-1 border-solid border-black">
          
          <!-- Short inputs container -->
          <div class="flex flex-col m-0 justify-center">
              <!-- row of inputs, two per row if space is available -->
              <div class="mb-0 flex flex-wrap gap-6">
                  <!-- input and their label containers -->
                  <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                      <label for="first_name">First Name</label>
                      {{ job_application_form.first_name }}
                  </div>
                  <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                      <label for="last_name">Last Name</label>
                      {{ job_application_form.last_name }}
                  </div>
              </div>
              <div class="my-0 flex flex-wrap gap-6">
                <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                  <label for="email">Email address</label>
                  {{ job_application_form.email }}
                </div>  
                <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                    <label for="phone_number">Phone Number</label>
                    {{ job_application_form.phone_number }}
                </div>
              </div>
              <div class="my-0 flex flex-col items-center">
                <p class="mt-2 text-2xl font-semibold">Cover Letter</p>
                {{ job_application_form.cover_letter }}
              </div>

              <div class="flex flex-col items-center mb-5">
                <h1 class="text-2xl font-semibold">Resumes</h1>
                {% if resumes %}
                <div class="resume_wrapper flex flex-col mt-0">
                    {% for resume in resumes %}
                    <div class="relative flex w-full mb-5 px-4 py-2 border-[2px] border-solid border-black rounded-xl bg-cyan-200 items-center">
                        <a href="{{ resume.file.url }}" target="_blank" class="flex-1">
                            <div class="flex items-center m-0">
                                <img src="{% static 'images/document.png' %}" class="w-8 h-8 mr-4">
                                <div class="flex flex-col m-0">
                                    <p class="overflow-hidden">{{ resume.filename }}</p>
                                    <p class="text-sm text-gray-600">Date Uploaded: {{ resume.date_uploaded }}</p>
                                  </div>
                            </div>
                        </a>
                        <input type="radio" name="resume_id" value="{{ resume.id }}"
                          {% if edit_application_fields.form.resume.id == resume.id %}
                          checked
                          {% endif %}>
                    </div>
                    {% endfor %}
                </div>
                {% endif %}
              </div>
          </div>
          
          <!-- Buttons -->
          <div class="w-full flex justify-end">
              <button id="job_application_cancel" class="px-3 py-2 rounded-xl bg-gray-200 text-black font-semibold" type="button">Cancel</button>
              <button id="job_application_submit" class="px-3 py-2 ml-5 rounded-xl bg-blue-600 text-white font-semibold" type="submit">Submit</button>
          </div>
       </form>
  </div>
    
</body>
</html>