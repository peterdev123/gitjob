{% load static %}
{% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <title>Job Posting Details</title>
    {% tailwind_css %}
    {% if messages %}
        {% include 'includes/message_box.html' %}
    {% endif %}
    <link rel="stylesheet" href="{% static 'css/dist/custom.css' %}">

    {{ request.user.skills | json_script:"skills" }}
    {{ request.user.experiences | json_script:"experiences" }}
    <script>
      $(document).ready(function(){
        $("#apply_job_btn").click(()=>{
          const skills = JSON.parse(document.getElementById("skills").textContent);
          const experiences = JSON.parse(document.getElementById("experiences").textContent);
          let skillsText = "", experiencesText = "";
          skills.forEach((skill)=>{ skillsText += `-${skill}\n`; })
          experiences.forEach((experience)=>{ experiencesText += `-${experience}\n`; })
          $("#skills_textarea").text(skillsText);
          $("#experiences_textarea").text(experiencesText);
          $("#apply_job_modal").show();
        });
        $("#apply_job_exit").click(()=>{
          $("#apply_job_modal").hide();
        })
        $("input[type='file']").change(function() { this.form.submit() })
      });
    </script>
</head>
<body class="w-screen h-screen">
    <!-- Navbar -->
    {% include 'includes/headings.html' %}
    <!-- Search Job Bar -->
    {% include 'includes/search_job_bar.html' %}
    <div class="bg-gray-300 flex flex-col">
      <div class="w-full mt-5 flex justify-center">
          <!-- Job Posting Details -->
          <div class="relative max-w-[650px] w-[55%] h-full m-3 p-7 bg-white rounded-xl">
              <a href="{% url 'home' %}"><img src="{% static 'images/cross_mark_icon.png' %}"
                class="absolute top-2 right-2 w-8 h-8"></a>
              <!-- First row -->
              <div class="flex mb-0">
                  <img src="{{ job_posting.company_logo.url }}" class="w-20 h-20 border-[1px] border-black border-solid rounded-lg">
                  <div class="flex flex-col">
                      <h1 class="text-xl font-bold ml-3">{{ job_posting.job_title }}</h1>
                      <div class="flex flex-wrap">
                          {% for tag in job_posting.tags %}
                          <div class="min-w-10 h-6 mx-3 mt-2 px-3 flex justify-center items-center text-xs bg-orange-300 box-border rounded-2xl border-2 border-solid border-black">
                            <p>{{ tag }}</p>
                          </div>
                          {% endfor %}
                        </div>
                  </div>
                  <!-- Add href for apply job -->
                  <a id="apply_job_btn" class="ml-auto mr-5 my-auto"><button class="w-24 h-8 bg-purple-700 text-white text-sm font-bold rounded-lg">Apply Now</button></a>
              </div>
              <!-- 2nd row -->
              <div>
                  <h1 class="mt-4 mb-1 text-sm font-bold">Job Description</h1>
                  <hr class="border-solid border-black text-lg">
                  <p class="text-sm">{{ job_posting.job_description }}</p>
                  <h1 class="mt-4 mb-1 text-sm font-bold">Essential Knowledge Skills And Experience</h1>
                  <hr class="border-solid border-black">
                  <p class="text-sm">{{ job_posting.core_competencies }}</p>
              </div>

          </div>
          <div class="max-w-[280px] w-[23%] w-1/4 h-full m-3 p-7 bg-white rounded-xl">
              <div class="flex">
                  <img class="w-4 h-4 mr-1 my-auto" src="{% static 'images/info_icon.png' %}">
                  <h1 class="">More Information</h1>
              </div>
              <h1 class="my-1 font-bold">Job Field</h1>
              <p>{{ job_posting.job_field }}</p>
              <h1 class="my-1 font-bold">Hiring Deadline</h1>
              <p>{{ job_posting.hiring_deadline }}</p>
              <h1 class="my-1 font-bold">Salary Range</h1>
              <p>₱{{ job_posting.min_salary }} - ₱{{ job_posting.max_salary }}</p>

          </div>
      </div>

      <!-- Other Jobs Scrollable -->
      <div class="flex max-w-[970px] w-[80%] mx-auto mt-6 overflow-x-auto flex-nowrap">
        {% for job_posting in other_job_postings %}
          <!-- Job-Posting Div -->
          <div class="p-2 pb-5 m-1 min-w-80 rounded-xl bg-white shadow-xl box-border">
            <!-- Colored Section -->
            <div class="relative p-5 pb-2 h-60 mb-5 bg-orange-300 rounded-xl">
              <h1 class="text-xl font-bold">{{ job_posting.job_title }}</h1>
              <img src="{{ job_posting.company_logo.url }}" class="w-10 h-10 my-2">
              <!-- Tags Section -->
              <div class="flex flex-wrap">
                {% for tag in job_posting.tags %}
                <div class="min-w-10 h-6 m-2 mb-1 px-3 flex justify-center items-center text-xs bg-orange-300 box-border rounded-2xl border-2 border-solid border-black">
                  <p>{{ tag }}</p>
                </div>
                {% endfor %}
              </div>
              <p class="text-xs absolute bottom-2">Open until:</p>
              <p class="text-xs absolute bottom-2 right-5">{{ job_posting.hiring_deadline }}</p>
            </div>
            <div class="flex justify-between">
              <p class="font-bold ml-3">₱{{ job_posting.min_salary }} - ₱{{ job_posting.max_salary }}</p>
              <a href="{% url 'job_posting' id=job_posting.id %}"><button class="w-20 h-8 mr-3 bg-black text-white rounded-2xl">Details</button></a>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Apply Job -->
    <div id="apply_job_modal" class="absolute w-3/5 p-10 py-5 top-[2rem] left-1/2 translate-x-[-50%] rounded-2xl border-2 border-black border-solid bg-gray-200 z-10" style="display: none;">
      <form method="POST" class="flex flex-col items-center">
          {% csrf_token %}
          <input type="hidden" name="form_type" value="apply_job_form">

          <h1 class="text-2xl text-black text-center">Apply Job Form</h1>
          <img id="apply_job_exit" src="{% static 'images/cross_mark_icon.png' %}" class="w-8 h-8 hover:cursor-pointer absolute top-6 right-6" alt="Exit Button">
   
          <hr class="w-[96%] mt-2 border-1 border-solid border-black">
          
          <!-- Short inputs container -->
          <div class="flex flex-col m-0 justify-center">
              <!-- row of inputs, two per row if space is available -->
              <div class="mb-0 flex flex-wrap justify-between">
                  <!-- input and their label containers -->
                  <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                      <label for="first_name">First Name</label>
                      <input type="text" name="first_name" id="first_name" class="profile_edit_input" 
                        value="{{ request.user.first_name }}" readonly>
                  </div>
                  <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                      <label for="last_name">Last Name</label>
                      <input type="text" name="last_name" id="last_name" class="profile_edit_input" 
                        value="{{ request.user.last_name }}" readonly>
                  </div>
              </div>
              <div class="my-0 flex flex-wrap">
                <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                  <label for="email">Email address</label>
                  <input type="text" name="email" id="email" class="profile_edit_input" 
                      value="{{ request.user.email }}">
                </div>  
                <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                    <label for="phone_number">Phone Number</label>
                    <input type="text" name="phone_number" id="phone_number" class="profile_edit_input" 
                        value="{{ request.user.phone_number }}">
                </div>
              </div>
              <div class="my-0 flex flex-wrap">
                  <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                    <label for="home_address">Home Address</label>
                    <input type="text" name="home_address" id="home_address" class="profile_edit_input" 
                          {% if user.job %} value="{{ request.user.home_address }}"{% endif %}>
                  </div>
                  <div class="m-0 flex flex-col flex-1 min-w-[250px]">
                      <label for="country">Country</label>
                      <input type="text" name="country" id="country" class="profile_edit_input" 
                          value="{{ request.user.country }}">
                  </div>
              </div>
              <div class="my-0 flex flex-col items-center">
                <p class="mt-2">Skills</p>
                <textarea id="skills_textarea" class="w-3/4 h-32 bg-white rounded-2xl">
                </textarea>
              </div>
              <div class="my-0 flex flex-col items-center">
                <p class="mt-2">Experiences</p>
                <textarea id="experiences_textarea" class="w-3/4 h-32 rounded-2xl"></textarea>
              </div>

              <p class="mx-auto mt-2">Resumes</p>
              <div class="w-[80%] mx-auto my-0 pt-2 pb-5 px-5 h-2/5 bg-gray-200 rounded-2xl flex flex-col items-center">
                <div class="resume_wrapper w-[80%] m-0 flex flex-col">
                    {% for resume in resumes %}
                    <div class="relative flex w-full h-[32px] mb-3 px-2 border-[2px] border-solid border-black rounded-xl items-center">
                        <a href="{{ resume.file.url }}" target="_blank">
                            <p class="overflow-hidden">{{ resume.filename }}</p>
                        </a>
                        <form method="post">
                            {% csrf_token %}
                            <input type="hidden" name="form_type" value="resume_delete_form">
                            <input type="hidden" name="id" value="{{ resume.id }}">
                            <img id="delete_resume_btn" src="{% static 'images/delete-icon.png' %}"
                            class="absolute w-5 h-5 hover:cursor-pointer right-1 top-1/2 translate-y-[-50%]">
                        </form>
                    </div>
                    {% endfor %}

                </div>
                <form method="post" enctype="multipart/form-data" class="w-[80%] mx-auto">
                    {% csrf_token %}
                    <input type="hidden" name="form_type" value="resume_upload_form">
                    <p class="w-full">
                        {{ resume_upload_form.resume_file }}
                    </p>
                </form>
            </div>
          </div>
          
          <!-- Buttons -->
          <div class="w-full flex justify-end">
              <button id="edit_profile_cancel" class="w-16 h-8 rounded-2xl border-2 border-black border-solid bg-white text-black" type="button">Cancel</button>
              <button id="edit_profile_confirm" class="w-28 h-8 ml-5 rounded-2xl border-2 border-black border-solid bg-blue-600 text-white" type="submit">Save Changes</button>
          </div>
       </form>
  </div>
    
</body>
</html>