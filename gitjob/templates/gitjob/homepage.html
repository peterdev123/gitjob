{% load static %} {% load static tailwind_tags %}
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Gitjob</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="{% static 'css/dist/homepage.css' %}"/> 
  </head>
  <body>
    <div class="min-h-screen mx-auto">

      {% include 'includes/headings.html' %}
      {{ request.user.username|json_script:"username" }}

      <!-- Search Bar Section -->
      {% include 'includes/search_job_bar.html' %}
  
      <!-- Filter and Explore Section -->
      <div class="flex w-full">
        <!-- Filter -->
        <div class="w-[150px] flex flex-col ml-16">
          <h2 class="text-lg font-bold pt-5">Filter</h2>
          <ul class="mt-4">
            <li class="text-s font-bold text-slate-500">Schedule</li>
            <li class="text-s">
              <input type="radio" id="full-time" name="full-time" />
              <label for="full-time" class="text-s">Full Time</label>
            </li>
            <li class="text-s">
              <input type="radio" id="part-time" name="part-time" />
              <label for="part-time" class="text-s">Part Time</label>
            </li>
            <li class="text-s">
              <input type="radio" id="internship" name="internship" />
              <label for="internship" class="text-s">Internship</label>
            </li>
            <li class="text-s">
              <input type="radio" id="project-work" name="project-work" />
              <label for="project-work" class="text-s">Project Work</label>
            </li>
          </ul>

          <!-- Salary range -->
          <div>
            <div class="text-s font-bold text-slate-500 mt-4">Salary Range</div>
            <div class="price-input flex justify-between">
              <div class="field flex items-center">
                <input
                  type="number"
                  class="input-min w-full h-10 text-s font-bold text-center border-0 outline-none"
                  value="0"
                />
              </div>
              <div
                class="separator w-28 text-s font-bold flex items-center justify-center"
              >
                -
              </div>
              <div class="field flex items-center">
                <input
                  type="number"
                  class="input-max w-full h-10 text-s font-bold text-center border-0 outline-none"
                  value="100000"
                />
              </div>
            </div>
            <div class="slider relative h-1 bg-gray-300 rounded-md">
              <div
                class="progress absolute left-1/4 right-1/4 h-full bg-black rounded-md"
              ></div>
            </div>
            <div class="range-input relative mt-3">
              <input
                type="range"
                class="range-min absolute w-full h-1 top-[-20px] pointer-events-none appearance-none"
                min="0"
                max="100000"
                value="0"
                step="1000"
              />
              <input
                type="range"
                class="range-max absolute w-full h-1 top-[-20px] pointer-events-none appearance-none"
                min="0"
                max="100000"
                value="100000"
                step="1000"
              />
            </div>
          </div>

          <div class="flex w-full max-w-[515px] mt-4 mx-auto">
            <!-- Job Field Dropdown -->
            <div class="flex flex-col">
              <label
                for="job-field"
                class="text-s text-slate-500 font-bold mb-4"
                >Job Field</label
              >
              <div class="relative">
                <select
                  id="job-field"
                  class="appearance-none w-[100px] bg-gray-200 border border-black rounded-[25px] h-[25px] pl-4 pr-10"
                >
                  <option value="" class="text-center">Any</option>
                  <option value="IT">Information Technology</option>
                  <option value="Finance">Finance</option>
                  <option value="Marketing">Marketing</option>
                  <option value="Engineering">Engineering</option>
                  <option value="Health">Health Care</option>
                </select>
                <!-- Arrow Icon -->
                <div
                  class="absolute right-3 top-1/2 transform -translate-y-1/2 pointer-events-none"
                >
                  <svg
                    class="w-4 h-4 text-gray-500"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      d="M5.23 7.21a.75.75 0 011.06 0L10 10.73l3.71-3.52a.75.75 0 011.06 1.06l-4.25 4a.75.75 0 01-1.06 0l-4.25-4a.75.75 0 010-1.06z"
                    />
                  </svg>
                </div>
              </div>
            </div>
          </div>
        </div>
        <!-- Separator Line -->
        <div class="h-screen w-[1px] bg-gray-400 mx-4"></div>
        <!-- Explore -->
        <div class="flex flex-col flex-grow">
          <h2 class="text-lg font-bold pt-5 ml-10 mr-auto">Explore</h2>
          <div class="flex flex-wrap justify-start p-5">
            {% for job_posting in job_postings %}
              <!-- Job-Posting Div -->
              <div class="job-posting p-2 pb-5 m-1 w-80 rounded-xl bg-white shadow-xl"
              data-min-salary="{{ job_posting.min_salary }}"
              data-max-salary="{{ job_posting.max_salary }}">
                <!-- Colored Section -->
                <div class="relative p-5 pb-2 h-60 mb-5 bg-orange-300 rounded-xl">
                  <h1 class="text-xl font-bold">{{ job_posting.job_title }}</h1>
                  {% if job_posting.company_logo %}
                  <img src="{{ job_posting.company_logo.url }}" class="w-10 h-10 my-2">
                  {% else %}
                  <div class="w-10 h-10 my-2 bg-gray-200 rounded-full flex items-center justify-center">
                  <p class="text-xs font-bold text-gray-500">No Logo</p>
                  </div>
                  {% endif %}
                  <!-- Tags Section -->
                  <div class="flex flex-wrap">
                    {% for tag in job_posting.tags %}
                    <div class="min-w-10 h-6 mx-2 mt-1 px-3 flex justify-center items-center text-xs bg-orange-300 box-border rounded-2xl border-2 border-solid border-black">
                      <p>{{ tag }}</p>
                    </div>
                    {% endfor %}
                  </div>
                  <p class="text-xs absolute bottom-2">Open until:</p>
                  <p class="text-xs absolute bottom-2 right-5">{{ job_posting.hiring_deadline }}</p>
                </div>
                <div class="flex justify-between">
                  <p class="font-bold ml-3">₱{{ job_posting.min_salary }} - ₱{{ job_posting.max_salary }}</p>
                  <a href="{% url 'job_posting' id=job_posting.id %}"><button class="w-20 h-8 mr-3 bg-black text-white rounded-2xl">Details</button></a>
                </div>
              </div>
            {% endfor %}
          </div>
          
        </div>
      </div>
    </div>
    <!-- <script src="{% static 'js/salary_slider.js' %}"></script> -->
    <script>
      console.log("JavaScript file loaded");

const rangeInputs = document.querySelectorAll(".range-input input"),
  priceInputs = document.querySelectorAll(".price-input input"),
  range = document.querySelector(".slider .progress"),
  jobPostings = document.querySelectorAll(".job-posting");

const priceGap = 1000; // Minimum gap between min and max values

// Helper function to update the range slider's progress bar
const updateSlider = (minVal, maxVal) => {
  range.style.left = ((minVal / rangeInputs[0].max) * 100).toFixed(2) + "%";
  range.style.right = (100 - (maxVal / rangeInputs[1].max) * 100).toFixed(2) + "%";
};

// Function to filter job postings based on the selected salary range
const filterJobPostings = () => {
    console.log("filterJobPostings called");
    const minSalary = parseInt(priceInputs[0].value, 10) || 0; // Fallback to 0
    const maxSalary = parseInt(priceInputs[1].value, 10) || 100000; // Fallback to 100000
    console.log(`Filtering with minSalary: ${minSalary}, maxSalary: ${maxSalary}`); // Debugging line
  
    jobPostings.forEach((job) => {
      const jobMinSalary = parseInt(job.getAttribute("data-min-salary"), 10);
      const jobMaxSalary = parseInt(job.getAttribute("data-max-salary"), 10);
  
      if (isNaN(jobMinSalary) || isNaN(jobMaxSalary)) {
        console.warn("Skipping job with invalid salary range:", job); // Debugging line
        job.style.display = "none"; 
      } else if (jobMaxSalary >= minSalary && jobMinSalary <= maxSalary) {
        job.style.display = "block"; 
      } else {
        job.style.display = "none";
      }
    });
  };
  

// Initialize the slider positions on page load
window.addEventListener("load", () => {
  const minPrice = 0; // Initial min price
  const maxPrice = 100000; // Initial max price

  // Set initial values for both price and range inputs
  priceInputs[0].value = minPrice;
  priceInputs[1].value = maxPrice;
  rangeInputs[0].value = minPrice;
  rangeInputs[1].value = maxPrice;

  updateSlider(minPrice, maxPrice);
  filterJobPostings(); // Initial filter on page load
});

// Update slider and price inputs when price input fields are changed
priceInputs.forEach((input) => {
    input.addEventListener("input", (e) => {
      console.log("Price input changed:", e.target.value); // Debugging line
      const minPrice = parseInt(priceInputs[0].value, 10);
      const maxPrice = parseInt(priceInputs[1].value, 10);
  
      if (maxPrice - minPrice >= priceGap) {
        if (e.target.classList.contains("input-min")) {
          rangeInputs[0].value = minPrice;
        } else {
          rangeInputs[1].value = maxPrice;
        }
        updateSlider(minPrice, maxPrice);
        filterJobPostings(); // Ensure this line is here
      }
    });
  });

// Handle range sliders when moved
rangeInputs.forEach((input) => {
    input.addEventListener("input", (e) => {
      console.log("Range input changed:", e.target.value); // Debugging line
      const minVal = parseInt(rangeInputs[0].value, 10);
      const maxVal = parseInt(rangeInputs[1].value, 10);
  
      if (maxVal - minVal < priceGap) {
        if (e.target.classList.contains("range-min")) {
          rangeInputs[0].value = maxVal - priceGap;
        } else {
          rangeInputs[1].value = minVal + priceGap;
        }
      } else {
        priceInputs[0].value = minVal;
        priceInputs[1].value = maxVal;
        updateSlider(minVal, maxVal);
        filterJobPostings(); // Ensure this line is here
      }
    });
  });

    </script>
  </body>
</html>
